# å¸³è™Ÿç®¡ç†ç³»çµ±ä½¿ç”¨æŒ‡å—

## æ¦‚è¿°

é€™å€‹ Flutter æ‡‰ç”¨ç¨‹å¼å·²ç¶“æ•´åˆäº†å®Œæ•´çš„å¸³è™Ÿç®¡ç†ç³»çµ±ï¼Œä½¿ç”¨ Firebase Authentication å’Œ Cloud Firestore ä¾†å¯¦ç¾è·¨è£ç½®çš„ç”¨æˆ¶ç™»å…¥å’Œè³‡æ–™åŒæ­¥ã€‚

## åŠŸèƒ½ç‰¹è‰²

### ğŸ” ç”¨æˆ¶èªè­‰
- **è¨»å†ŠåŠŸèƒ½**: ç”¨æˆ¶å¯ä»¥ä½¿ç”¨é›»å­éƒµä»¶å’Œå¯†ç¢¼è¨»å†Šæ–°å¸³è™Ÿ
- **ç™»å…¥åŠŸèƒ½**: æ”¯æ´é›»å­éƒµä»¶/å¯†ç¢¼ç™»å…¥
- **å¯†ç¢¼é‡è¨­**: ç”¨æˆ¶å¯ä»¥é€éé›»å­éƒµä»¶é‡è¨­å¯†ç¢¼
- **è·¨è£ç½®ç™»å…¥**: åŒä¸€å¸³è™Ÿå¯åœ¨ä¸åŒè£ç½®ä¸Šç™»å…¥

### ğŸ“Š ç”¨æˆ¶è³‡æ–™ç®¡ç†
- **å€‹äººè³‡æ–™**: å„²å­˜ç”¨æˆ¶åã€é›»å­éƒµä»¶ã€æ‰‹æ©Ÿè™Ÿç¢¼ç­‰åŸºæœ¬è³‡è¨Š
- **ç™»å…¥è¨˜éŒ„**: è¿½è¹¤è¨»å†Šæ™‚é–“ã€æœ€å¾Œç™»å…¥æ™‚é–“ã€ç™»å…¥æ¬¡æ•¸
- **éŠæˆ²è³‡æ–™**: é‡‘å¹£ã€è³¼è²·ç‰©å“ã€ç²å¾—çš„å‹³ç« ç­‰éŠæˆ²ç›¸é—œè³‡æ–™
- **è¨­å‚™ç®¡ç†**: æ”¯æ´å¤šè¨­å‚™ç™»å…¥ï¼Œå¯ç®¡ç†è¨­å‚™ä»¤ç‰Œ

### ğŸ›¡ï¸ å®‰å…¨æ€§
- **å¯†ç¢¼é©—è­‰**: å¯†ç¢¼é•·åº¦è‡³å°‘6å€‹å­—å…ƒ
- **é›»å­éƒµä»¶é©—è­‰**: ä½¿ç”¨æ­£å‰‡è¡¨é”å¼é©—è­‰é›»å­éƒµä»¶æ ¼å¼
- **é‡è¤‡è¨»å†Šæª¢æŸ¥**: é˜²æ­¢åŒä¸€é›»å­éƒµä»¶é‡è¤‡è¨»å†Š
- **éŒ¯èª¤è™•ç†**: å®Œæ•´çš„éŒ¯èª¤è™•ç†å’Œç”¨æˆ¶å‹å¥½çš„éŒ¯èª¤è¨Šæ¯

## æŠ€è¡“æ¶æ§‹

### å¾Œç«¯æœå‹™
- **Firebase Authentication**: è™•ç†ç”¨æˆ¶èªè­‰
- **Cloud Firestore**: å„²å­˜ç”¨æˆ¶è³‡æ–™å’ŒéŠæˆ²è³‡æ–™
- **SharedPreferences**: æœ¬åœ°è³‡æ–™å¿«å–

### ä¸»è¦æª”æ¡ˆ
- `lib/user_service.dart`: æ ¸å¿ƒç”¨æˆ¶æœå‹™é¡åˆ¥
- `lib/login_page.dart`: ç™»å…¥é é¢
- `lib/register_page.dart`: è¨»å†Šé é¢
- `lib/main.dart`: æ‡‰ç”¨ç¨‹å¼å…¥å£é»

## ä½¿ç”¨æ–¹æ³•

### 1. ç”¨æˆ¶è¨»å†Š
```dart
// ä½¿ç”¨ UserService è¨»å†Šæ–°ç”¨æˆ¶
final success = await UserService.registerUser(
  email: 'user@example.com',
  password: 'password123',
  username: 'username',
  phone: '0912345678',
);
```

### 2. ç”¨æˆ¶ç™»å…¥
```dart
// ä½¿ç”¨ UserService ç™»å…¥
final userData = await UserService.loginUser(
  email: 'user@example.com',
  password: 'password123',
);
```

### 3. æª¢æŸ¥ç™»å…¥ç‹€æ…‹
```dart
// æª¢æŸ¥ç”¨æˆ¶æ˜¯å¦å·²ç™»å…¥
final isLoggedIn = UserService.isUserLoggedIn();

// ç²å–ç•¶å‰ç”¨æˆ¶ ID
final userId = UserService.getCurrentUserId();
```

### 4. ç²å–ç”¨æˆ¶è³‡æ–™
```dart
// ç²å–ç•¶å‰ç”¨æˆ¶çš„å®Œæ•´è³‡æ–™
final userData = await UserService.getCurrentUserData();
```

### 5. æ›´æ–°ç”¨æˆ¶è³‡æ–™
```dart
// æ›´æ–°ç”¨æˆ¶è³‡æ–™
final success = await UserService.updateUserData({
  'username': 'newUsername',
  'phone': '0987654321',
});
```

### 6. é‡è¨­å¯†ç¢¼
```dart
// ç™¼é€é‡è¨­å¯†ç¢¼éƒµä»¶
final success = await UserService.resetPassword('user@example.com');
```

### 7. ç”¨æˆ¶ç™»å‡º
```dart
// ç™»å‡ºç”¨æˆ¶
await UserService.logoutUser();
```

### 8. åˆªé™¤å¸³è™Ÿ
```dart
// åˆªé™¤ç”¨æˆ¶å¸³è™Ÿï¼ˆéœ€è¦é‡æ–°ç™»å…¥ï¼‰
final success = await UserService.deleteUserAccount();
```

## è³‡æ–™çµæ§‹

### ç”¨æˆ¶è³‡æ–™æ¨¡å‹
```dart
{
  'uid': 'ç”¨æˆ¶å”¯ä¸€è­˜åˆ¥ç¢¼',
  'email': 'é›»å­éƒµä»¶',
  'username': 'ç”¨æˆ¶å',
  'phone': 'æ‰‹æ©Ÿè™Ÿç¢¼',
  'registrationDate': 'è¨»å†Šæ™‚é–“',
  'lastLoginDate': 'æœ€å¾Œç™»å…¥æ™‚é–“',
  'loginCount': 'ç™»å…¥æ¬¡æ•¸',
  'coins': 'é‡‘å¹£æ•¸é‡',
  'purchasedItems': ['è³¼è²·çš„ç‰©å“åˆ—è¡¨'],
  'earnedMedals': ['ç²å¾—çš„å‹³ç« åˆ—è¡¨'],
  'isActive': 'å¸³è™Ÿæ˜¯å¦å•Ÿç”¨',
  'profileImageUrl': 'å€‹äººç…§ç‰‡URL',
  'deviceTokens': ['è¨­å‚™ä»¤ç‰Œåˆ—è¡¨'],
}
```

## éŒ¯èª¤è™•ç†

### å¸¸è¦‹éŒ¯èª¤ä»£ç¢¼
- `user-not-found`: ç”¨æˆ¶ä¸å­˜åœ¨
- `wrong-password`: å¯†ç¢¼éŒ¯èª¤
- `invalid-email`: é›»å­éƒµä»¶æ ¼å¼ä¸æ­£ç¢º
- `user-disabled`: å¸³è™Ÿå·²è¢«åœç”¨
- `too-many-requests`: ç™»å…¥å˜—è©¦æ¬¡æ•¸éå¤š
- `email-already-in-use`: é›»å­éƒµä»¶å·²è¢«ä½¿ç”¨

### éŒ¯èª¤è™•ç†ç¯„ä¾‹
```dart
try {
  final userData = await UserService.loginUser(
    email: email,
    password: password,
  );
} on FirebaseAuthException catch (e) {
  String message = 'ç™»å…¥å¤±æ•—ï¼Œè«‹ç¨å¾Œå†è©¦';
  if (e.code == 'user-not-found' || e.code == 'wrong-password') {
    message = 'å¸³è™Ÿæˆ–å¯†ç¢¼éŒ¯èª¤';
  } else if (e.code == 'invalid-email') {
    message = 'é›»å­éƒµä»¶æ ¼å¼ä¸æ­£ç¢º';
  }
  // é¡¯ç¤ºéŒ¯èª¤è¨Šæ¯
}
```

## å®‰å…¨æ€§å»ºè­°

### å¯†ç¢¼å®‰å…¨
- å¯†ç¢¼é•·åº¦è‡³å°‘6å€‹å­—å…ƒ
- å»ºè­°ä½¿ç”¨åŒ…å«å¤§å°å¯«å­—æ¯ã€æ•¸å­—å’Œç‰¹æ®Šå­—å…ƒçš„å¼·å¯†ç¢¼
- å®šæœŸæ›´æ›å¯†ç¢¼

### å¸³è™Ÿå®‰å…¨
- ä¸è¦èˆ‡ä»–äººåˆ†äº«ç™»å…¥è³‡è¨Š
- åœ¨å…¬å…±è¨­å‚™ä¸Šä½¿ç”¨å¾Œè¨˜å¾—ç™»å‡º
- å®šæœŸæª¢æŸ¥ç™»å…¥è¨˜éŒ„

### è³‡æ–™ä¿è­·
- ç”¨æˆ¶è³‡æ–™ä½¿ç”¨ Firebase çš„å®‰å…¨è¦å‰‡ä¿è­·
- æœ¬åœ°è³‡æ–™ä½¿ç”¨ SharedPreferences åŠ å¯†å„²å­˜
- æ•æ„Ÿè³‡è¨Šä¸æœƒåœ¨æ—¥èªŒä¸­é¡¯ç¤º

## éƒ¨ç½²æ³¨æ„äº‹é …

### Firebase é…ç½®
1. ç¢ºä¿ `google-services.json` æª”æ¡ˆå·²æ­£ç¢ºé…ç½®
2. åœ¨ Firebase Console ä¸­å•Ÿç”¨ Authentication å’Œ Firestore
3. è¨­å®šé©ç•¶çš„ Firestore å®‰å…¨è¦å‰‡

### ç’°å¢ƒè®Šæ•¸
- ç¢ºä¿ Firebase å°ˆæ¡ˆ ID æ­£ç¢º
- æª¢æŸ¥ API é‡‘é‘°æ˜¯å¦æœ‰æ•ˆ
- ç¢ºèªç¶²åŸŸç™½åå–®è¨­å®š

## æ¸¬è©¦

### å–®å…ƒæ¸¬è©¦
```bash
flutter test test/user_service_test.dart
```

### æ•´åˆæ¸¬è©¦
```bash
flutter test integration_test/
```

## æ•…éšœæ’é™¤

### å¸¸è¦‹å•é¡Œ
1. **Firebase åˆå§‹åŒ–å¤±æ•—**: æª¢æŸ¥ `google-services.json` æª”æ¡ˆ
2. **ç¶²è·¯é€£ç·šå•é¡Œ**: ç¢ºèªç¶²è·¯é€£ç·šå’Œ Firebase å°ˆæ¡ˆè¨­å®š
3. **æ¬Šé™éŒ¯èª¤**: æª¢æŸ¥ Firestore å®‰å…¨è¦å‰‡
4. **ç‰ˆæœ¬ç›¸å®¹æ€§**: ç¢ºä¿æ‰€æœ‰ Firebase å¥—ä»¶ç‰ˆæœ¬ç›¸å®¹

### é™¤éŒ¯æŠ€å·§
- ä½¿ç”¨ `print` æˆ– `debugPrint` è¼¸å‡ºé™¤éŒ¯è³‡è¨Š
- æª¢æŸ¥ Firebase Console çš„æ—¥èªŒ
- ä½¿ç”¨ Flutter Inspector æª¢æŸ¥ UI å•é¡Œ

## æ›´æ–°æ—¥èªŒ

### v1.0.0
- åˆå§‹ç‰ˆæœ¬ç™¼å¸ƒ
- åŸºæœ¬è¨»å†Šå’Œç™»å…¥åŠŸèƒ½
- Firebase Authentication æ•´åˆ
- Cloud Firestore è³‡æ–™å„²å­˜
- è·¨è£ç½®ç™»å…¥æ”¯æ´

## æ”¯æ´

å¦‚æœ‰ä»»ä½•å•é¡Œæˆ–å»ºè­°ï¼Œè«‹è¯ç¹«é–‹ç™¼åœ˜éšŠæˆ–æŸ¥çœ‹ Firebase å®˜æ–¹æ–‡æª”ã€‚
