# data_init.py
# (版本 4.0 - 聚焦北捷百題)
import sqlite3
import os
import random

# 資料庫檔案路徑 (與 app.py 保持一致)
DATABASE = 'taipei_metro_quiz.db'

def setup_database():
    """建立資料庫 schema"""
    conn = sqlite3.connect(DATABASE)
    cursor = conn.cursor()

    # 刪除舊的表格以重新建立
    cursor.execute("DROP TABLE IF EXISTS Questions")
    cursor.execute("DROP TABLE IF EXISTS Options")
    cursor.execute("DROP TABLE IF EXISTS Leaderboard")

    # 建立 Questions 表
    cursor.execute("""
    CREATE TABLE Questions (
        question_id INTEGER PRIMARY KEY AUTOINCREMENT,
        question_text TEXT NOT NULL,
        correct_option_text TEXT NOT NULL,
        difficulty TEXT NOT NULL CHECK(difficulty IN ('簡單', '中等', '困難')),
        explanation TEXT
    )
    """)

    # 建立 Options 表
    cursor.execute("""
    CREATE TABLE Options (
        option_id INTEGER PRIMARY KEY AUTOINCREMENT,
        question_id INTEGER,
        option_text TEXT NOT NULL,
        FOREIGN KEY (question_id) REFERENCES Questions(question_id)
    )
    """)

    # 建立 Leaderboard 表
    cursor.execute("""
    CREATE TABLE Leaderboard (
        name TEXT NOT NULL,
        score INTEGER NOT NULL,
        timestamp DATETIME DEFAULT CURRENT_TIMESTAMP
    )
    """)

    conn.commit()
    conn.close()
    print(f"資料庫 '{DATABASE}' 已成功建立。")

def populate_questions():
    """產生並填入 100 題【嚴格聚焦於台北捷運】的題目"""
    
    # 格式: (問題, 正確答案, [所有選項清單], 難度, 詳解)
    # 所有選項清單已包含正確答案，並確保四個選項不重複
    questions_data = [
    # --- 簡單 (40題) ---
    ("台北捷運路線中，代表「淡水信義線」的顏色是？", "紅色", ["紅色", "綠色", "藍色", "黃色"], "簡單", "淡水信義線是R線(Red)，代表色為紅色。"),
    ("前往台北101大樓，應在哪個捷運站下車？", "台北101/世貿站", ["市政府站", "象山站", "信義安和站", "台北101/世貿站"], "簡單", "淡水信義線的台北101/世貿站4號出口，可直達台北101購物中心。"),
    ("板南線的代表顏色是？", "藍色", ["紅色", "藍色", "綠色", "橘色"], "簡單", "板南線是BL線(Blue)，代表色為藍色，是運量最大的路線。"),
    ("想去「國父紀念館」參觀，應搭到哪個捷運站？", "國父紀念館站", ["市政府站", "忠孝敦化站", "國父紀念館站", "象山站"], "簡單", "板南線的國父紀念館站，出站即達園區。"),
    ("台北捷運松山新店線的代表顏色是？", "綠色", ["棕色", "橘色", "綠色", "黃色"], "簡單", "松山新店線是G線(Green)，代表色為綠色。"),
    ("前往饒河街觀光夜市，在哪個捷運站下車最為方便？", "松山站", ["南京三民站", "後山埤站", "松山站", "南港站"], "簡單", "松山站5號出口，出站即是饒河街夜市。"),
    ("中和新蘆線的代表顏色是？", "橘色", ["黃色", "紅色", "橘色", "藍色"], "簡單", "中和新蘆線是O線(Orange)，代表色為橘色。"),
    ("前往年輕人聚集的「西門町」，應在哪個捷運站下車？", "西門站", ["台北車站", "龍山寺站", "西門站", "北門站"], "簡單", "西門站是板南線與松山新店線的交會站，6號出口最為熱鬧。"),
    ("文湖線的代表顏色是？", "棕色", ["灰色", "黃色", "棕色", "紫色"], "簡單", "文湖線是BR線(Brown)，代表色為棕色。"),
    ("想搭乘貓空纜車，應轉乘至文湖線的哪一個車站？", "動物園站", ["木柵站", "萬芳社區站", "動物園站", "貓空站"], "簡單", "搭文湖線至終點站「動物園站」，再步行至纜車站轉乘。"),
    ("台北捷運第一條通車的營運路線是？", "文湖線", ["淡水信義線", "板南線", "文湖線", "松山新店線"], "簡單", "文湖線木柵段於1996年通車，是台北捷運的起點。"),
    ("前往「中正紀念堂」與兩廳院，應在哪個捷運站下車？", "中正紀念堂站", ["古亭站", "台大醫院站", "東門站", "中正紀念堂站"], "簡單", "紅線與綠線交會的中正紀念堂站。"),
    ("前往萬華的信仰中心「龍山寺」，應在哪個捷運站下車？", "龍山寺站", ["西門站", "江子翠站", "小南門站", "龍山寺站"], "簡單", "板南線的龍山寺站，出站即達。"),
    ("想去「淡水老街」和漁人碼頭，應搭到淡水信義線的哪一個終點站？", "淡水站", ["象山站", "北投站", "關渡站", "淡水站"], "簡單", "紅線北端終點站即淡水站。"),
    ("台北捷運的環狀線(第一階段)的代表顏色是？", "黃色", ["紫色", "天藍色", "黃色", "灰色"], "簡單", "環狀線是Y線(Yellow)。"),
    ("想去信義區的「新光三越」逛街，在哪個捷運站下車最方便？", "市政府站", ["永春站", "後山埤站", "市政府站", "南港展覽館站"], "簡單", "板南線市政府站與信義商圈百貨連通。"),
    ("前往台北小巨蛋觀看演唱會，應在哪個捷運站下車？", "台北小巨蛋站", ["南京復興站", "中山國中站", "台北小巨蛋站", "松山機場站"], "簡單", "松山新店線台北小巨蛋站。"),
    ("想去「大安森林公園」野餐散步，應在哪個捷運站下車？", "大安森林公園站", ["大安站", "東門站", "科技大樓站", "大安森林公園站"], "簡單", "淡水信義線的大安森林公園站。"),
    ("台北捷運列車上，提供給有需要人士的「博愛座」，通常是什麼顏色？", "深藍色", ["粉紅色", "深藍色", "亮黃色", "墨綠色"], "簡單", "台北捷運的博愛座為深藍色。"),
    ("哪一個捷運站與台灣高鐵、台灣鐵路構成「三鐵共構」的交通樞紐？", "台北車站", ["松山車站", "西門站", "台北車站", "板橋站"], "簡單", "台北車站是北捷、台鐵、高鐵的核心共構樞紐。"),
    ("哪一個捷運站位於路網最東邊？", "南港展覽館站", ["昆陽站", "南港站", "象山站", "南港展覽館站"], "簡單", "南港展覽館站是板南線與文湖線的東端。"),
    ("哪一個捷運站位於路網最北邊？", "淡水站", ["新北投站", "關渡站", "紅樹林站", "淡水站"], "簡單", "淡水站位於紅線最北端。"),
    ("使用電子票證搭乘台北捷運，票價優惠情形為？", "依票種有不同折扣", ["全面8折", "固定折扣5元", "依票種有不同折扣", "無任何優惠"], "簡單", "常客優惠、定期票等方案依票種不同，優惠條件不同。"),
    ("台北捷運系統中，已通車且全線位於新北市境內的路線是？", "環狀線(第一階段)", ["淡水信義線", "板南線", "環狀線(第一階段)", "中和新蘆線"], "簡單", "環狀線第一階段車站均位於新北市。"),
    ("前往知名的「鼎泰豐」信義本店，在哪個捷運站下車最方便？", "東門站", ["忠孝新生站", "大安站", "東門站", "古亭站"], "簡單", "淡水信義線東門站出站即永康商圈。"),
    ("「新北投溫泉區」應搭到哪站？", "新北投站", ["北投站", "奇岩站", "石牌站", "新北投站"], "簡單", "搭新北投支線至終點站新北投站。"),
    ("「美麗華百樂園」摩天輪附近的捷運站是？", "劍南路站", ["大直站", "西湖站", "劍南路站", "港墘站"], "簡單", "文湖線劍南路站3號出口即達。"),
    ("捷運「市政府站」2號出口直接連通哪一組合？", "統一時代百貨與市府轉運站", ["新光三越A8館與台北轉運站(京站)", "微風信義與台北轉運站", "統一時代百貨與市府轉運站", "誠品信義與東區地下街"], "簡單", "市政府站連通統一時代百貨(UNIQLO/Uni-Ustyle)與市府轉運站。"),
    ("想去遼寧街夜市，哪個捷運站下車較近？", "南京復興站", ["松江南京站", "中山國中站", "南京復興站", "行天宮站"], "簡單", "從南京復興站步行數分鐘即可抵達。"),
    ("想參觀「台北市立美術館」及「台北故事館」，在哪個捷運站下車方便？", "圓山站", ["劍潭站", "民權西路站", "圓山站", "大橋頭站"], "簡單", "圓山站1號出口穿越花博公園即可到達。"),
    ("哪一個捷運站的英文站名是 Chiang Kai-Shek Memorial Hall？", "中正紀念堂站", ["國父紀念館站", "中正紀念堂站", "忠烈祠站", "行天宮站"], "簡單", "中正紀念堂站的英文為 Chiang Kai-Shek Memorial Hall。"),
    ("台北捷運最短的支線是？", "新北投支線", ["小碧潭支線", "貓空纜車", "新北投支線", "環狀線"], "簡單", "新北投支線全長最短。"),
    ("淡水信義線與板南線的轉乘站是？", "台北車站", ["西門站", "忠孝復興站", "台北車站", "中山站"], "簡單", "台北車站為紅藍交會。"),
    ("前往公館商圈及台灣大學，應在哪個捷運站下車？", "公館站", ["萬隆站", "台電大樓站", "公館站", "科技大樓站"], "簡單", "松山新店線公館站。"),
    ("想去師大夜市，在哪個捷運站下車最近？", "台電大樓站", ["古亭站", "公館站", "台電大樓站", "中正紀念堂站"], "簡單", "台電大樓站3號出口最便捷。"),
    ("哪一條捷運線沒有與淡水信義線直接交會？", "文湖線", ["淡水信義線", "松山新店線", "文湖線", "中和新蘆線"], "簡單", "文湖線與紅線無直接轉乘站。"),
    ("「永康街」應從哪個捷運站前往？", "東門站", ["大安森林公園站", "古亭站", "東門站", "忠孝新生站"], "簡單", "東門站是永康街商圈入口。"),
    ("在捷運站「黃線區域」內，哪種行為被禁止？", "飲食", ["飲食", "睡覺", "化妝", "看影片"], "簡單", "黃線區域禁止飲食，可依法開罰。"),
    ("高運量列車關門前的提示音多為哪種音色？", "鋼琴音效", ["小提琴", "長笛", "鋼琴音效", "吉他"], "簡單", "多為「叮咚」類鋼琴音效。"),
    ("前往「台北市立兒童新樂園」，淡水信義線應在哪站轉乘紅30公車最方便？", "劍潭站", ["士林站", "劍潭站", "圓山站", "中山國中站"], "簡單", "可由劍潭站轉乘紅30等公車前往。"),

    # --- 中等 (40題) ---
    ("哪一個捷運站是淡水信義線和中和新蘆線的共同轉乘站？", "東門站", ["中山站", "古亭站", "松江南京站", "東門站"], "中等", "東門站是紅線與橘線轉乘站，也是永康商圈門戶。"),
    ("哪一個轉乘站同時是「板南線」與「中和新蘆線」的交會點？", "忠孝新生站", ["忠孝復興站", "西門站", "忠孝新生站", "松江南京站"], "中等", "忠孝新生站為藍線與橘線轉乘。"),
    ("「松山文創園區」從哪個捷運站步行前往最近？", "市政府站", ["國父紀念館站", "市政府站", "永春站", "南京三民站"], "中等", "市政府站1或2號出口，步行約10分鐘。"),
    ("桃園機場捷運可在「三重站」與台北捷運的哪條路線轉乘？", "中和新蘆線", ["淡水信義線", "松山新店線", "環狀線", "中和新蘆線"], "中等", "可在三重站站內轉乘。"),
    ("哪一個捷運站體設計融入大量書法藝術作品？", "中正紀念堂站", ["龍山寺站", "行天宮站", "善導寺站", "中正紀念堂站"], "中等", "站內公共藝術融合古典元素。"),
    ("哪一個捷運站可以轉乘到「小碧潭支線」？", "七張站", ["大坪林站", "新店區公所站", "新店站", "七張站"], "中等", "小碧潭支線於七張站換乘。"),
    ("文湖線列車採用哪種輪胎／軌道系統？", "膠輪", ["鐵輪", "磁浮", "空氣輪", "膠輪"], "中等", "文湖線使用膠輪系統。"),
    ("哪一個捷運站的月台上有幾米《地下鐵》主題的裝置藝術？", "南港站", ["市政府站", "台北車站", "南港站", "忠孝新生站"], "中等", "板南線南港站月台有幾米《地下鐵》裝置。"),
    ("想去迪化街或「大稻埕碼頭」，在哪個捷運站下車較方便？", "北門站", ["大橋頭站", "雙連站", "中山站", "北門站"], "中等", "由北門站步行至迪化街南段與碼頭路程較短。"),
    ("捷運「大安森林公園站」位於淡水信義線的哪兩站之間？", "東門站與大安站", ["大安站與信義安和站", "東門站與大安站", "中正紀念堂站與東門站", "大安站與台北101/世貿站"], "中等", "位於信義路上，介於東門與大安之間。"),
    ("想去「剝皮寮歷史街區」參觀，應在哪個捷運站下車？", "龍山寺站", ["西門站", "小南門站", "龍山寺站", "江子翠站"], "中等", "由龍山寺站步行數分鐘可達。"),
    ("台北捷運哪一線的轉乘站有專屬進站音樂（例如台北車站、中山站）？", "淡水信義線", ["板南線", "文湖線", "淡水信義線", "中和新蘆線"], "中等", "紅線轉乘站使用特製進站音樂。"),
    ("哪一個捷運站是板南線與文湖線的共同轉乘站？", "忠孝復興站", ["忠孝新生站", "大安站", "忠孝復興站", "南京復興站"], "中等", "忠孝復興站為藍線與棕線轉乘。"),
    ("淡水信義線的「北投—象山」區間車，列車編號通常以哪個數字開頭？", "2", ["1", "2", "3", "8"], "中等", "紅線2開頭常為區間車（北投—象山）。"),
    ("哪一站名與過去「台灣省立台北師範學校」有歷史淵源？", "台電大樓站", ["古亭站", "師大站", "台電大樓站", "公館站"], "中等", "站區域與師範大學舊校地相關。"),
    ("忠孝復興站位於哪一個行政區？", "大安區", ["中山區", "松山區", "大安區", "信義區"], "中等", "站址與出入口均屬大安區。"),
    ("捷運列車上的緊急通話鈕通常設置在哪？", "車門邊或車廂前後端", ["座椅下方", "天花板上", "車門邊或車廂前後端", "窗戶旁"], "中等", "多設於車門旁立柱或車廂連接處。"),
    ("哪一站的站名源自於舊地名「梘尾」？", "景美站", ["景安站", "萬隆站", "景美站", "大坪林站"], "中等", "景美舊名「梘尾」，後改名。"),
    ("哪一個車站的站名與附近的知名醫院同名？", "台大醫院站", ["榮總站", "馬偕醫院站", "台大醫院站", "長庚醫院站"], "中等", "紅線台大醫院站。"),
    ("在捷運站內遺失物品，應到哪裡尋求協助？", "任何車站的詢問處", ["警察局", "終點站辦公室", "任何車站的詢問處", "捷運總公司"], "中等", "詢問處受理通報與協尋。"),
    ("哪一個車站的出口直接與「台北轉運站(京站)」連通？", "台北車站", ["市政府站", "中山站", "台北車站", "松山站"], "中等", "台北車站連通台北轉運站(京站)，非市府轉運站。"),
    ("哪一條路線有行經「松山機場」？", "文湖線", ["松山新店線", "板南線", "淡水信義線", "文湖線"], "中等", "文湖線松山機場站。"),
    ("文湖線屬於哪種運量系統？", "中運量", ["輕運量", "高運量", "中運量", "重運量"], "中等", "文湖線車廂較窄、無人駕駛。"),
    ("哪一個車站的主題造型有「大船入港」意象？", "淡水站", ["關渡站", "南港展覽館站", "淡水站", "動物園站"], "中等", "淡水站紅色斜頂與意象設計。"),
    ("哪一站常作為前往「烘爐地南山福德宮」的起點？", "南勢角站", ["景安站", "永安市場站", "南勢角站", "頂溪站"], "中等", "可在南勢角站轉乘公車或計程車。"),
    ("捷運「雙連站」附近的「文昌宮」主要祈求？", "考試順利", ["財運亨通", "身體健康", "考試順利", "姻緣美滿"], "中等", "雙連文昌宮以考試祈福知名。"),
    ("哪一個車站是環狀線與松山新店線的轉乘站？", "大坪林站", ["景安站", "十四張站", "大坪林站", "新店區公所站"], "中等", "大坪林站為黃綠交會。"),
    ("想體驗站外的「溫泉手湯」，應前往哪個站？", "新北投站", ["北投站", "陽明山站", "新北投站", "行義路站"], "中等", "新北投站區外可體驗。"),
    ("哪一站的站名與舊地名「錫口」相關？", "松山站", ["南港站", "饒河站", "松山站", "後山埤站"], "中等", "松山舊名「錫口」，為昔日河港。"),
    ("在捷運站內，手扶梯正確宣導語為？", "緊握扶手、站穩踏階（兩側皆可站立）", ["靠右站立、讓出左側", "禁止奔跑", "緊握扶手、站穩踏階（兩側皆可站立）", "注意腳步"], "中等", "北捷宣導兩側皆可站立，不鼓勵行走。"),
    ("哪一個車站是環狀線與板南線的轉乘站？", "板橋站", ["新埔站", "府中站", "板橋站", "新埔民生站"], "中等", "板橋站黃藍轉乘。"),
    ("台北捷運的吉祥物（頭戴列車的麻雀）名字是？", "捷米", ["北捷寶寶", "麻吉", "捷米", "嗶嗶"], "中等", "台北捷運吉祥物是「捷米（JEME）」。"),
    ("台北大眾捷運股份有限公司成立於哪一年？", "1994年", ["1990年", "1996年", "1994年", "2000年"], "中等", "北捷公司成立於1994年。"),
    ("哪一站的副站名是「台灣大學」？", "公館站", ["台電大樓站", "科技大樓站", "公館站", "萬隆站"], "中等", "公館站副站名為台灣大學。"),
    ("哪一個車站是中和新蘆線與環狀線的轉乘站？", "景安站", ["永安市場站", "南勢角站", "景安站", "頭前庄站"], "中等", "景安站橘黃轉乘。"),
    ("想前往「台北當代藝術館」，哪個站下車最近？", "中山站", ["雙連站", "台北車站", "中山站", "善導寺站"], "中等", "中山站步行約5分鐘。"),
    ("前往「松山機場」若要搭捷運，最直接的是？", "文湖線松山機場站", ["松山新店線南京三民站", "板南線市政府站", "文湖線松山機場站", "淡水信義線中山站"], "中等", "文湖線直達松山機場。"),
    ("忠孝復興站與哪兩條路線交會？", "板南線與文湖線", ["板南線與松山新店線", "文湖線與淡水信義線", "板南線與文湖線", "中和新蘆線與文湖線"], "中等", "忠孝復興站為藍棕交會。"),

    # --- 困難 (20題) ---
    ("台北捷運哪一條重運量路線全線皆為地下？", "板南線", ["淡水信義線", "松山新店線", "板南線", "中和新蘆線"], "困難", "板南線自南港至頂埔皆為地下。"),
    ("在「北投站」轉乘新北投支線，屬於哪種月台轉乘型式？", "西班牙式月台布局", ["島式月台", "側式月台", "港灣式月台", "西班牙式月台布局"], "困難", "同月台雙向轉乘的西班牙式佈局。"),
    ("捷運「唭哩岸站」之名最早源自於何者？", "平埔族社名", ["附近山形", "清代將軍", "一種石頭", "平埔族社名"], "困難", "來自凱達格蘭族社名 Ki-ligan 的音轉。"),
    ("在「北門站」站體可見清代遺構，內容為？", "機器局遺構", ["台北府城牆腳", "舊鐵道軌", "台灣總督府地基", "機器局遺構"], "困難", "站內原地保存台北機器局遺構。"),
    ("哪一個站名沿用歷史常用拼寫而非現行漢語拼音？", "淡水站 (Tamsui)", ["新店站 (Xindian)", "象山站 (Xiangshan)", "新埔站 (Xinpu)", "淡水站 (Tamsui)"], "困難", "Tamsui 的譯名沿用已久而保留。"),
    ("台北捷運高運量系統的軌距為多少？", "1435公釐", ["1067公釐", "1435公釐", "1520公釐", "762公釐"], "困難", "採用標準軌距 1435 mm。"),
    ("文湖線 370 型列車由哪一家公司製造？", "龐巴迪公司", ["西門子", "阿爾斯通", "龐巴迪公司", "川崎重工"], "困難", "文湖線現役主力為 Bombardier 370 型。"),
    ("月台邊緣黃色警示燈閃爍代表？", "列車即將進站", ["列車已離站", "本列車不載客", "列車即將進站", "月台間隙過大"], "困難", "提示列車進站請注意安全。"),
    ("環狀線的列車採用哪種輪軌與編組？", "鋼輪鋼軌、4節車廂", ["膠輪、2節", "鋼輪鋼軌、4節車廂", "磁浮、3節", "鋼輪鋼軌、6節車廂"], "困難", "環狀線為中運量鋼輪鋼軌、4節編組。"),
    ("2001 年造成台北捷運嚴重淹水的颱風是？", "納莉颱風", ["賀伯颱風", "象神颱風", "納莉颱風", "莫拉克颱風"], "困難", "納莉帶來豪雨，市區淹水並重創捷運。"),
    ("台北捷運公司首批通車發行紀念票是為慶祝哪段通車？", "木柵線(文湖線)", ["淡水線", "新中線", "木柵線(文湖線)", "板南線"], "困難", "1996 年木柵線通車所發行。"),
    ("哪一個捷運站與醫院共構的案例最知名？", "萬芳醫院站", ["圓山站", "市政府站", "萬芳醫院站", "南港站"], "困難", "萬芳醫院站與市立萬芳醫院共構。"),
    ("哪一個車站穿堂層有大型公共藝術作品「邂逅」？", "世貿/台北101站", ["大安森林公園站", "松山機場站", "世貿/台北101站", "圓山站"], "困難", "紅線世貿/台北101站之公共藝術。"),
    ("哪一個車站曾在淡水線未全通前短暫作為臨時終點？", "中山站", ["雙連站", "台北車站", "中山站", "中正紀念堂站"], "困難", "早期營運階段曾以中山為臨時終點。"),
    ("依《大眾捷運法》，在禁止飲食區飲食最高可處罰鍰？", "新台幣7500元", ["新台幣1500元", "新台幣3000元", "新台幣7500元", "新台幣10000元"], "困難", "可處1500~7500元，題問最高額。"),
    ("台北捷運路網中，哪一支線最短且以觀光溫泉為主題？", "新北投支線", ["小碧潭支線", "文湖線南段", "新北投支線", "環狀線南段"], "困難", "新北投支線全長短、服務溫泉區。"),
    ("哪座車站的公共藝術最與歷史考古直接相連？", "北門站", ["忠孝新生站", "北門站", "大橋頭站", "善導寺站"], "困難", "站內展示清代機器局遺構。"),
    ("到淡水老街若想欣賞河岸夕照，最方便的捷運終點站是？", "淡水站", ["紅樹林站", "竹圍站", "淡水站", "關渡站"], "困難", "淡水站出站即河岸步道。"),
    ("淡水信義線的象山端常作為哪類旅遊的起點？", "信義商圈逛街與象山步道登高", ["故宮導覽", "鶯歌陶瓷街", "九份老街", "信義商圈逛街與象山步道登高"], "困難", "可逛信義商圈並登象山看夜景。"),
    ("板南線最東端與文湖線相會於哪站？", "南港展覽館站", ["昆陽站", "南港站", "南港展覽館站", "忠孝復興站"], "困難", "兩線在南港展覽館交會。"),
]

    conn = sqlite3.connect(DATABASE)
    cursor = conn.cursor()

    for q_text, correct_ans, all_opts, difficulty, explanation in questions_data:
        # 再次確認選項列表本身沒有重複
        if len(set(all_opts)) != 4:
            print(f"警告：題目 '{q_text}' 的選項中有重複項，已跳過此題。")
            continue
        
        # 插入問題
        cursor.execute(
            "INSERT INTO Questions (question_text, correct_option_text, difficulty, explanation) VALUES (?, ?, ?, ?)",
            (q_text, correct_ans, difficulty, explanation)
        )
        question_id = cursor.lastrowid

        # 隨機打亂選項順序
        random.shuffle(all_opts)

        # 插入選項
        for option_text in all_opts:
            cursor.execute(
                "INSERT INTO Options (question_id, option_text) VALUES (?, ?)",
                (question_id, option_text)
            )

    conn.commit()
    conn.close()
    print(f"已成功填入 {len(questions_data)} 題至資料庫。")

def main():
    """主函數：設定與填入資料庫"""
    # 檢查資料庫是否存在，如果存在則刪除重新建立
    if os.path.exists(DATABASE):
        print(f"偵測到舊的資料庫檔案 '{DATABASE}'。")
        # 這裡不再自動刪除，而是提示使用者手動操作，更安全
        # os.remove(DATABASE)
        # print(f"舊的資料庫檔案 '{DATABASE}' 已被刪除。")
    
    print("正在建立新的資料庫...")
    setup_database()
    print("正在填入題目...")
    populate_questions()
    print("資料庫初始化完成！")

if __name__ == '__main__':
    main()
