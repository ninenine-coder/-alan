<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>台北捷運知識王</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Noto+Sans+TC:wght@400;500;700;900&display=swap" rel="stylesheet">
    
    <!-- CSS 樣式直接寫在這裡 -->
    <style>
        /* style.css */
        @import url('https://fonts.googleapis.com/css2?family=Noto+Sans+TC:wght@400;500;700;900&display=swap');

        body {
            font-family: 'Noto Sans TC', sans-serif; /* 更新字體 */
            background: linear-gradient(135deg, #4c1d95, #7c3aed); /* 深紫色漸變背景 */
            min-height: 100vh;
            display: flex;
            align-items: center;
            justify-content: center;
            padding: 1rem;
        }

        /* 主遊戲容器的樣式 */
        .main-container {
            background-color: rgba(255, 255, 255, 0.9); /* 半透明白色背景 */
            backdrop-filter: blur(8px); /* 模糊效果 */
            border-radius: 2rem; /* 更大的圓角 */
            box-shadow: 0 20px 25px -5px rgb(0 0 0 / 0.1), 0 8px 10px -6px rgb(0 0 0 / 0.1); /* 陰影 */
            max-width: 500px; /* 最大寬度 */
            width: 100%;
            overflow: hidden;
            position: relative;
            /* 捷運路線圖作為背景，半透明疊加 */
            background-image: linear-gradient(rgba(255,255,255,0.9), rgba(255,255,255,0.95)), url('https://upload.wikimedia.org/wikipedia/commons/2/26/Taipei_Metro_Route_Map_2023.png');
            background-size: cover;
            background-position: center;
            min-height: 600px; /* 確保有足夠高度 */
            display: flex;
            flex-direction: column;
            justify-content: space-between;
        }

        /* 按鈕基礎樣式 */
        .btn-primary {
            background-color: #8b5cf6; /* 紫色 */
            color: white;
            font-weight: 700;
            border-radius: 1rem; /* 圓角 */
            padding: 1rem 2rem;
            transition: all 0.3s ease;
            box-shadow: 0 4px 6px rgba(0,0,0,0.1);
        }

        .btn-primary:hover {
            background-color: #7c3aed; /* 懸停時顏色變深 */
            transform: translateY(-3px) scale(1.05); /* 懸停時上浮並放大 */
            box-shadow: 0 10px 15px -3px rgba(0,0,0,0.1);
        }

        /* 選項按鈕樣式 */
        .option-btn {
            background-color: #f3f4f6;
            color: #374151;
            border: 2px solid #e5e7eb;
            transition: all 0.2s ease;
            text-align: left;
            padding: 1rem;
            border-radius: 0.75rem; /* 圓角 */
            font-weight: 500;
            box-shadow: 0 2px 4px rgba(0,0,0,0.05);
        }

        .option-btn:not([disabled]):hover {
            border-color: #8b5cf6; /* 懸停時邊框變色 */
            background-color: #ede9fe; /* 懸停時背景變淺 */
        }

        .option-btn:disabled {
            cursor: not-allowed;
            opacity: 0.8;
        }

        /* 正確答案樣式 */
        .option-btn.correct {
            background-color: #10b981 !important; /* Tailwind green-500 */
            color: white !important;
            border-color: #059669 !important; /* Tailwind green-700 */
            transform: scale(1.05);
            animation: pulse-correct 0.5s;
        }

        /* 錯誤答案樣式 */
        .option-btn.incorrect {
            background-color: #ef4444 !important; /* Tailwind red-500 */
            color: white !important;
            border-color: #dc2626 !important; /* Tailwind red-700 */
            animation: shake 0.5s;
        }

        /* 進度條樣式 */
        .timer-bar-inner {
            transition: width 0.2s linear; /* 平滑過渡 */
            background: linear-gradient(90deg, #22c55e, #a3e635); /* 綠色漸變 */
        }

        /* 動畫 */
        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(20px); }
            to { opacity: 1; transform: translateY(0); }
        }
        .animate-fadeIn { animation: fadeIn 0.5s ease-out forwards; }

        @keyframes pulse-correct {
            0% { transform: scale(1.05); }
            50% { transform: scale(1.1); }
            100% { transform: scale(1.05); }
        }

        @keyframes shake {
            10%, 90% { transform: translateX(-2px); }
            20%, 80% { transform: translateX(2px); }
            30%, 50%, 70% { transform: translateX(-4px); }
            40%, 60% { transform: translateX(4px); }
        }

        /* 連擊顯示樣式 */
        #combo-display {
            position: fixed; /* 固定在視窗中 */
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            font-size: 4rem;
            font-weight: 900;
            color: #f59e0b; /* 琥珀色 */
            text-shadow: 2px 2px 4px rgba(0,0,0,0.5);
            pointer-events: none; /* 允許點擊穿透 */
            opacity: 0;
            transition: all 0.5s ease;
            z-index: 100; /* 確保在最上層 */
            white-space: nowrap; /* 防止換行 */
        }

        #combo-display.show {
            opacity: 1;
            transform: translate(-50%, -50%) scale(1.5); /* 顯示時放大 */
        }

        /* 模態視窗關閉按鈕 */
        .modal-close-btn {
            font-size: 2.5rem;
            line-height: 1;
            font-weight: bold;
            cursor: pointer;
            background: none;
            border: none;
            color: #a0aec0; /* 淺灰色 */
            transition: color 0.2s ease;
        }

        .modal-close-btn:hover {
            color: #4a5568; /* 深灰色 */
        }

        /* 捷運列車動畫容器 */
        .train-animation-container {
            position: absolute;
            bottom: 0;
            left: 0;
            width: 100%;
            height: 100px; /* 調整高度以容納圖片，給予更多空間 */
            overflow: hidden;
            pointer-events: none; /* 允許點擊穿透 */
            z-index: 10;
        }

        /* 捷運列車圖片樣式 */
        .train-animation-container img {
            position: absolute;
            bottom: 0; /* 圖片底部對齊容器底部 */
            left: -15%; /* 初始位置 */
            width: 90px; /* 調整圖片寬度，讓傑米更小一點 */
            height: auto;
            animation: train-move 15s linear infinite; /* 火車移動動畫 */
            z-index: 10;
            opacity: 0.9; /* 稍微透明 */
            transform: scaleX(-1); /* 圖片水平翻轉，讓傑米面向行進方向 */
        }
        
        /* 捷運列車動畫 */
        @keyframes train-move {
            0% { left: -15%; } /* 從左邊外側開始 */
            100% { left: 115%; } /* 移動到右邊外側 */
        }


        /* 排行榜模態視窗列表項高亮 */
        #leaderboard-list li {
            transition: all 0.2s ease;
        }

        #leaderboard-list li.bg-amber-100 {
            background-color: #fffbeb; /* 淺黃色背景 */
            border: 1px solid #fcd34d; /* 黃色邊框 */
            box-shadow: 0 2px 8px rgba(252, 211, 77, 0.4);
        }

        #leaderboard-list li span.text-amber-500 {
            color: #f59e0b; /* 琥珀色文字 */
        }

        /* 響應式調整 */
        @media (max-width: 640px) {
            .main-container {
                padding: 1rem;
                border-radius: 0; /* 手機上移除圓角，全螢幕顯示 */
                height: 100vh;
                max-height: unset;
            }
            .btn-primary {
                font-size: 1.25rem;
                padding: 0.8rem 1.5rem;
            }
            .option-btn {
                font-size: 1rem;
                padding: 1rem;
            }
            #question-text {
                font-size: 1.5rem;
            }
            #combo-display {
                font-size: 3rem;
            }
            .train-animation-container img { /* 調整圖片寬度 */
                width: 100px; /* 手機上傑米小一點 */
                animation-duration: 10s; /* 手機上火車跑快一點 */
            }
            .train-animation-container {
                height: 80px; /* 手機上容器高度也小一點 */
            }
        }

        /* --- 新增樣式 --- */
        /* 分數彈出動畫 */
        #score-popup {
            position: absolute;
            right: 1.5rem; /* 靠近分數顯示 */
            top: 4.5rem; /* 在分數顯示下方一點 */
            font-size: 1.75rem;
            font-weight: 900;
            color: #10b981; /* 綠色 */
            opacity: 0;
            pointer-events: none; /* 允許點擊穿透 */
            z-index: 90; /* 確保在分數顯示之上，但在連擊顯示之下 */
            animation: fade-up-out 1.5s ease-out; /* 綁定動畫 */
        }
        @keyframes fade-up-out {
            0% { transform: translateY(0); opacity: 1; }
            100% { transform: translateY(-40px); opacity: 0; }
        }
    </style>
    <!-- 音效預載 -->
    <audio id="background-music" loop preload="auto" volume="0.3" autoplay>
        <!-- 請將 src 替換為您的音樂檔案的公開 URL，或將檔案放在與 index.html 相同的資料夾並使用相對路徑 -->
        <source src="捷運進站音樂 - 小禾 (youtube).mp3" type="audio/mpeg">
        您的瀏覽器不支援音訊元素。
    </audio>
    <audio id="game-start-sound" src="https://actions.google.com/sounds/v1/ui/swipe.ogg" preload="auto"></audio>
    <audio id="correct-sound" src="https://actions.google.com/sounds/v1/positive/success.ogg" preload="auto"></audio>
    <audio id="incorrect-sound" src="https://actions.google.com/sounds/v1/negative/failure.ogg" preload="auto"></audio>
</head>
<body class="min-h-screen flex items-center justify-center p-4">
    <!-- 連擊顯示 (獨立於主容器外，確保層級最高) -->
    <div id="combo-display"></div>

    <div class="main-container">
        <!-- 捷運列車動畫容器 -->
        <div id="train-container" class="train-animation-container hidden">
            <!-- 將 SVG 替換為圖片 -->
            <img src="傑米搭捷運.png" alt="捷運列車">
        </div>

        <!-- 開始畫面 -->
        <div id="start-screen" class="p-8 text-center flex flex-col items-center justify-center h-[28rem] animate-fadeIn">
            <h1 class="text-4xl md:text-5xl font-black text-violet-700 mb-2">台北捷運知識王</h1>
            <p class="text-gray-600 mb-8">挑戰你對台北捷運的了解程度！</p>
            <button id="start-game-btn" class="btn-primary text-2xl">
                <svg xmlns="http://www.w3.org/2000/svg" class="h-8 w-8 inline-block mr-2" viewBox="0 0 20 20" fill="currentColor">
                    <path fill-rule="evenodd" d="M10 18a8 8 0 100-16 8 8 0 000 16zM9.555 7.168A1 1 0 008 8v4a1 1 0 001.555.832l3-2a1 1 0 000-1.664l-3-2z" clip-rule="evenodd" />
                </svg>
                開始遊玩
            </button>
        </div>

        <!-- 遊戲畫面 -->
        <div id="game-screen" class="p-6 md:p-8 hidden">
            <div id="score-popup"></div> <!-- 新增：分數彈出動畫容器 -->
            <div class="flex justify-between items-center mb-4">
                <div id="question-counter" class="text-lg font-bold text-gray-600"></div>
                <div id="score-display" class="px-4 py-2 bg-violet-100 text-violet-700 font-bold rounded-full text-lg">分數: 0</div>
            </div>
            <div class="w-full bg-gray-200 rounded-full h-4 mb-4 overflow-hidden">
                <div id="timer-bar" class="h-full rounded-full timer-bar-inner"></div>
            </div>
            <div class="mb-6 min-h-[100px] flex items-center justify-center">
                <p id="question-text" class="text-xl md:text-2xl font-bold text-gray-800 text-center"></p>
            </div>
            <div id="options-container" class="grid grid-cols-1 gap-4"></div>
            <div id="feedback-display" class="text-center font-bold text-2xl mt-6 min-h-[40px]"></div>
        </div>

        <!-- 結束畫面 -->
        <div id="end-screen" class="p-8 text-center hidden">
            <h3 id="end-screen-title" class="text-2xl font-bold text-amber-500 mb-2"></h3> <!-- 新增：結束稱號顯示 -->
            <h2 class="text-4xl font-black text-violet-700 mb-2">遊戲結束！</h2>
            <p class="text-gray-600 mb-4">你的最終成績是：</p>
            <p id="final-score" class="text-7xl font-bold text-violet-600 mb-8"></p>
            <div class="space-y-4">
                <button id="restart-btn" class="btn-primary w-full text-xl">再玩一次</button>
                <button id="review-wrong-answers-btn" class="bg-gray-200 text-gray-700 font-bold rounded-xl p-4 w-full text-xl hover:bg-gray-300 transition">回顧錯題</button>
                <button id="show-leaderboard-btn" class="bg-amber-400 text-white font-bold rounded-xl p-4 w-full text-xl hover:bg-amber-500 transition">查看排行榜</button>
            </div>
        </div>

        <!-- 錯題回顧模態視窗 -->
        <div id="review-modal" class="fixed inset-0 bg-black bg-opacity-60 hidden items-center justify-center p-4 z-50">
            <div class="bg-white rounded-2xl p-6 w-full max-w-lg flex flex-col">
                <div class="flex justify-between items-center mb-4 flex-shrink-0">
                    <h3 class="text-2xl font-bold">錯題詳解</h3>
                    <button id="close-review-modal-btn" class="text-gray-500 hover:text-gray-800 modal-close-btn">&times;</button>
                </div>
                <div class="overflow-y-auto max-h-[70vh]">
                    <div id="wrong-answers-list" class="space-y-4"></div>
                </div>
            </div>
        </div>

        <!-- 排行榜模態視窗 -->
        <div id="leaderboard-modal" class="fixed inset-0 bg-black bg-opacity-60 hidden items-center justify-center p-4 z-50">
            <div class="bg-white rounded-2xl p-6 w-full max-w-lg">
                <div class="flex justify-between items-center mb-4">
                    <h3 class="text-2xl font-bold text-amber-500">🏆 排行榜</h3>
                    <button id="close-leaderboard-modal-btn" class="text-gray-500 hover:text-gray-800 modal-close-btn">&times;</button>
                </div>
                <div class="overflow-y-auto max-h-[70vh]">
                    <ul id="leaderboard-list" class="space-y-2"></ul>
                </div>
            </div>
        </div>
    </div>

    <!-- 引入前端遊戲邏輯 -->
    <script src="main.js"></script>
</body>
</html>