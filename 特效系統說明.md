# 特效系統說明

## 概述
特效系統已經成功整合到應用程式中，現在支援從 `assets/MRT影片/` 資料夾中播放特效影片。

## 功能特色

### 1. 影片特效支援
- 特效不再是靜態圖片，而是動態影片
- 支援從 `assets/MRT影片/` 資料夾讀取 `.mp4` 檔案
- 影片會循環播放，提供持續的特效效果

### 2. 特效檔案結構
```
assets/
└── MRT影片/
    ├── 特效1.mp4
    ├── 特效2.mp4
    ├── 特效3.mp4
    ├── 特效4.mp4
    ├── 特效5.mp4
    ├── 特效6.mp4
    ├── 特效7.mp4
    ├── 特效8.mp4
    ├── 特效9.mp4
    ├── 特效10.mp4
    └── 特效11.mp4
```

### 3. 技術實現

#### EffectService 類別
- 管理特效影片的播放、暫停、停止
- 提供特效選擇和狀態管理
- 支援影片路徑生成和驗證

#### 主要方法
- `playEffect(String effectName)`: 播放指定特效
- `stopEffect()`: 停止特效播放
- `pauseEffect()`: 暫停特效播放
- `resumeEffect()`: 恢復特效播放
- `getSelectedEffect()`: 獲取當前選中的特效
- `setSelectedEffect(String effectName)`: 設置選中的特效

### 4. UI 整合

#### 背包頁面 (PetPage)
- 特效項目顯示影片預覽圖標
- 支援特效選擇和應用
- 顯示特效狀態（已擁有/未擁有）

#### 特效預覽
- 使用影片圖標表示特效類型
- 顯示特效名稱和類型標籤
- 支援未擁有項目的灰色遮罩

### 5. 資料庫整合

#### Firebase 資料結構
特效項目在 Firebase 中的結構：
```json
{
  "name": "特效1",
  "圖片": "assets/MRT影片/特效1.mp4",
  "價格": 100,
  "常見度": "常見",
  "category": "特效"
}
```

#### 本地存儲
- 特效選擇狀態保存在 SharedPreferences
- 使用 `selected_effect_$username` 鍵值對
- 影片路徑使用 `selected_effect_video_$username` 鍵值對

## 使用方法

### 1. 添加新特效
1. 將 `.mp4` 檔案放入 `assets/MRT影片/` 資料夾
2. 在 Firebase 的 "特效" 集合中添加對應的資料
3. 更新 `pubspec.yaml` 確保影片檔案被包含在 assets 中

### 2. 特效命名規則
- 特效檔案名稱應與 Firebase 中的 `name` 欄位一致
- 例如：Firebase 中名為 "特效1" 的項目對應 `特效1.mp4` 檔案

### 3. 播放特效
```dart
// 播放特效
await EffectService().playEffect('特效1');

// 停止特效
await EffectService().stopEffect();

// 暫停特效
await EffectService().pauseEffect();
```

## 依賴項目

### 新增依賴
```yaml
dependencies:
  video_player: ^2.8.2
```

### 權限設定
在 `android/app/src/main/AndroidManifest.xml` 中添加：
```xml
<uses-permission android:name="android.permission.INTERNET"/>
```

## 注意事項

1. **檔案大小**: 影片檔案應適當壓縮以減少應用程式大小
2. **格式支援**: 目前支援 `.mp4` 格式
3. **路徑一致性**: 確保 Firebase 中的特效名稱與檔案名稱完全一致
4. **記憶體管理**: 特效服務會自動管理影片控制器的生命週期

## 未來擴展

1. **更多格式支援**: 可擴展支援 `.webm`、`.mov` 等格式
2. **特效組合**: 支援多個特效同時播放
3. **自定義特效**: 允許用戶上傳自己的特效影片
4. **特效預覽**: 在選擇前提供特效預覽功能

## 故障排除

### 常見問題
1. **影片無法播放**: 檢查檔案路徑和格式是否正確
2. **特效不顯示**: 確認 Firebase 資料是否正確同步
3. **記憶體洩漏**: 確保在適當時候調用 `stopEffect()`

### 調試方法
- 使用 `LoggerService` 查看特效相關的日誌
- 檢查 `assets/MRT影片/` 資料夾中的檔案
- 驗證 Firebase 中的特效資料結構
